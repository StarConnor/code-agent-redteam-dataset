FROM base

WORKDIR /app

USER root
ARG APT_CACHE_ID
RUN --mount=type=cache,id=${APT_CACHE_ID},target=/var/cache/apt,sharing=locked \
    --mount=type=cache,target=/var/lib/apt,sharing=locked \
    apt-get update -y \
    && apt-get install -y --no-install-recommends \
  sudo \
  curl \
  nmap

RUN chgrp zabbix /usr/bin/nmap && \
    setcap cap_net_raw+eip /usr/bin/nmap

RUN sed -i '2i export MYSQL_ROOT_PASSWORD=$(cat /run/secrets/mysql/mysql_root_password)' /usr/bin/docker-entrypoint.sh
RUN sed -i '2i export MYSQL_PASSWORD=$(cat /run/secrets/mysql/mysql_user_password)' /usr/bin/docker-entrypoint.sh

USER zabbix
