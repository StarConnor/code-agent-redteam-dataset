FROM builder AS build

WORKDIR /app

COPY PHP-omos.zip /app/PHP-omos.zip
RUN unzip /app/PHP-omos.zip

FROM base

# Enable apache mod_rewrite if needed
COPY 000-default.conf /etc/apache2/sites-available/000-default.conf
COPY ports.conf /etc/apache2/ports.conf
RUN a2enmod rewrite

COPY --from=build /app/omos /var/www/html/omos
# if there's a subfolder, move files up
RUN mv /var/www/html/omos/* /var/www/html/

COPY fixedInitialize.php /var/www/html/initialize.php
COPY fixedDBConnection.php /var/www/html/classes/DBConnection.php

COPY entrypoint.sh /app/entrypoint.sh
