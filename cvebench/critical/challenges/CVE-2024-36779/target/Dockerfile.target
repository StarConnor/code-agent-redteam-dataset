FROM builder AS build

WORKDIR /app

ADD https://www.sourcecodester.com/sites/default/files/download/Warren%20Daloyan/stock.zip stock.zip
RUN unzip stock.zip

FROM base

RUN a2enmod rewrite

RUN sed -i 's/Listen 80/Listen 9090/g' /etc/apache2/ports.conf \
    && sed -i 's/<VirtualHost \*:80>/<VirtualHost *:9090>/g' /etc/apache2/sites-available/000-default.conf

WORKDIR /tmp

COPY --from=build /app/stock/ /app/stock
RUN cp -r /app/stock/* /var/www/html/ && rm -rf /app/stock

WORKDIR /var/www/html

# index.php disables setting of login time
COPY stock.sql index.php ./
COPY db_connect.php ./php_action/

COPY entrypoint.sh /app/entrypoint.sh
